# 2026-01-31 Evening Session

## Voice Calling Project â€” OpenAI Realtime API + Twilio
- **Goal:** Low-latency two-way voice calling (replace slow STTâ†’LLMâ†’TTS pipeline)
- **Solution chosen:** OpenAI Realtime API + Twilio Media Streams
- **Research:** Full report at `memory/research_voice_calling.md`
- **Implementation:** Built standalone server at `voice-realtime/index.js`
  - Fastify + WebSocket server on port 6060
  - Twilio Media Streams â†’ OpenAI Realtime WebSocket bridge
  - System prompt: Henry III persona
  - Outbound call via POST /make-call
  - AI greets first on pickup
  - Interrupt handling (clears buffer when user speaks)
- **ngrok tunnel:** `fausto-acclimatizable-compellably.ngrok-free.dev` â†’ port 6060
- **Status:** Twilio calling works, OpenAI session connects, but **OpenAI billing quota exceeded**
  - Paul needs to add payment method at platform.openai.com/settings/organization/billing
  - Even $10 credits enough for ~30 min of test calls
- **Paul's cell:** +16047637285

## Debugging Journey
1. First attempts: 401 auth error â€” shell env had OpenRouter key overriding .env
2. Fix: `dotenv.config({ override: true })` 
3. Second issue: Response failed â€” quota exceeded on Realtime API
4. Need: OpenAI billing setup

## Compaction Prevention Improvements
- Added context monitoring rules to AGENTS.md (check every ~10 messages, after big tool outputs)
- Created cron job `context-monitor` â€” checks every 5 min, warns at 50/70/80%
- Previous compaction lost entire conversation â€” summary was empty

## Response Speed Discussion
- Paul noted Opus 4.5 is slow for chat
- Discussed Telegram streaming (streamMode: partial already enabled)
- Paul prefers focusing on voice calling over text speed improvements

## Config Notes
- voice-call plugin already configured with Twilio (was set up previously)
- Twilio number: +17789077285
- ElevenLabs key available as backup TTS

## VOICE CALLING SUCCESS! ðŸŽ‰
- **First successful two-way realtime voice call at ~9:31 PM**
- Paul said "It sounded great. An amazing first call."
- OpenAI Realtime API + Twilio Media Streams working
- Server: `voice-realtime/index.js` on port 6060
- ngrok tunnel: `fausto-acclimatizable-compellably.ngrok-free.dev`
- Process session: `faint-ember`
- Voice: alloy (default)
- Can trigger calls from chat via POST to /make-call
- Paul wants to keep building â€” next: voice selection, smarter persona, inbound calling
- Paul's cell: +16047637285
- dotenv fix: must use `{ override: true }` since shell has OPENROUTER key as OPENAI_API_KEY
- VAD tuning: threshold=0.6, silence_duration=500ms, prefix_padding=200ms
- Remaining issue: occasional dead air from VAD false triggers (cancelled responses w/ 0 audio chunks)
- Main latency source: likely ngrok free tier
- ngrok authtoken in config but no login email on record â€” Paul checking
- Potential fix: Tailscale Funnel (free, no ngrok needed)
- Server process: rapid-haven (port 6060)
- ngrok process: kind-orbit

## Nano Banana Pro (Image Gen)
- Installed `uv` via brew, nano-banana-pro skill working
- Generated pipeline diagram: `voice-pipeline-diagram.png`
- Paul loved it: "one of the coolest diagrams I've ever seen"
- API key: already in skills config

## Clawdbot Integration (Phase 2 started!)
- Added 5 tools to voice Henry: check_weather, search_tasks, list_tasks, add_task, send_message_to_clawdbot
- Tools execute locally via execSync (toodledo.js CLI, gog CLI, curl)
- Function calling works: OpenAI Realtime sends `response.function_call_arguments.done`, we execute and return via `conversation.item.create` with `function_call_output`
- Added per-call custom instructions (systemPrompt, greeting, noTools params on /make-call)
- Added transcript logging (input_audio_transcription + output_audio_transcript)
- Paul tested: task lookup works but slow/unfiltered, task creation not yet tested
- **PIZZA TEST**: Henry called a real pizza place, ordered a large pepperoni with extra cheese, called back to ask ready time and cheese type. Full transcript captured. IT WORKED.
- Task improvements needed: faster lookups, better filtering, add_task tool added but untested

## Google Drive Setup
- Enabled Drive API on Google project
- Created folder structure: Henry III â†’ Architecture & Diagrams, Credentials & Config, Research, Projects
- Projects/Voice Calling contains all voice system files + .env backup
- Convention: Drive project folder names = Toodledo task names
- Top folder: https://drive.google.com/drive/folders/1f7BHru31keq6e8_-CSFxkK20K4YcUonW

## Toodledo Task Updated (443006523)
- Marked [x] Clawdbot integration as DONE (celebrate victories!)
- Added "Enhanced Clawdbot Integration" with 9 sub-items
- Added hang up capability to shortcomings list

## Current State at End of Session
- Voice realtime server running (rapid-haven, port 6060)
- ngrok tunnel running (kind-orbit) 
- All code at: `voice-realtime/index.js`
- VAD settings: threshold=0.6, silence=500ms, prefix=200ms
- Still has occasional dead air from VAD false triggers
- Next steps: Tailscale Funnel to replace ngrok, more VAD tuning
- Context hit 68% â€” Paul aware, compaction recommended

## Tailscale Setup
- Signed in via **GitHub account** (HenryHeth)
- Installed via brew (v1.94.1)
- Running in userspace mode: `tailscaled --tun=userspace-networking --socket=/tmp/tailscaled.sock`
- Hostname: henry-voice (100.117.189.86)
- Tailnet has other machines: henrys-virtual-machine, henrys-virtual-machine-1

## TODO: Tailscale Funnel Setup
Paul needs to do these steps, then tell me to continue:

1. **Open Tailscale app** on the Mac (it's installed v1.94.1 but daemon not running)
2. **Sign in** to Tailscale if prompted
3. **Enable Funnel** in Tailscale admin console: https://login.tailscale.com/admin/acls â€” add `"nodeAttrs": [{"target": ["*"], "attr": ["funnel"]}]` to ACL policy
4. Once Tailscale is connected, tell me and I'll run:
   - `tailscale funnel 6060` â€” exposes voice server directly
   - Update `voice-realtime/.env` with the Tailscale URL
   - Kill ngrok (no longer needed)
   - Restart voice server
   - Test call

## Future Voice Ideas (from Paul)
- Custom voice for Henry III (ElevenLabs voice cloning or OpenAI custom)
- Outbound call projects: find new tires for Paul's car, travel planning
- Generate TTS samples of all OpenAI voices and send via Telegram for easy comparison

## Session Summary (Full Day)
- Built two-way realtime voice calling from scratch in one session
- Stack: Twilio + OpenAI Realtime API + Fastify WebSocket bridge
- Code: `voice-realtime/index.js` (port 6060)
- Working: outbound calls, AI greeting, multi-turn conversation, interrupt handling, tool calling, transcripts
- Clawdbot tool integration: weather, tasks, calendar, message queue, add_task
- Per-call custom instructions: called a pizza place and ordered!
- Tailscale Funnel attempted â€” auth works but WebSocket proxy fails in userspace mode
- Nano Banana Pro: installed uv, generated 2 architecture diagrams
- Google Drive: enabled API, created Henry III folder structure, uploaded all files
- Convention established: Drive folder names = Toodledo task names
- Toodledo Phase 2 task created with full checklist, Clawdbot integration marked done
- Memory rules added: go slow with tasks, show drafts, use checkboxes, never touch closed tasks
- Future: custom voice, tire shopping calls, travel planning, TTS voice samples
- Paul's cell: +16047637285
